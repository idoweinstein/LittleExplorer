{% extends 'base.html' %}
{% block content %}

<!--
    TODO: find a better place for this script tag
-->
<script>
    window.onload = () => {
        for (const catergory of ["min_age", "max_age", "capacity"]) {
            const value = document.querySelector(`#${catergory}_value`);
            const input = document.querySelector(`#${catergory}`);
            value.textContent = input.value;
            input.addEventListener("input", (event) => {
              if (document.querySelector("#min_age").value > document.querySelector("#max_age").value) {
                /* Enfore min <= max */
                document.querySelector("#min_age").value = document.querySelector("#max_age").value = input.value;
                document.querySelector("#min_age_value").textContent = document.querySelector("#max_age_value").textContent = input.value;
              }
              /* Update value label */
              value.textContent = event.target.value;
            });
        }
    }
    $('#multi3').mdbRange({
        width: '100%',
        single: {
            active: true,
            multi: {
                active: true,
                rangeLength: 2
            },
        }
    });
</script>

<body>
    <!-- <link rel="stylesheet" href="..\static\search.css"> -->
    <form method="GET" action="/search">
        <div class="d-flex justify-content-center">
           <div  style="margin-top: 50px;">
              <input type="radio" name="method" value="name" id="name"  {% if not request.method or request.method != 'location' %} checked {% endif %}><label for="name">חיפוש לפי שם</label>
              <input type="radio" name="method" value="location" id="location"  {% if request.method and request.method == 'location' %} checked {% endif %} ><label for="location">חיפוש לפי מקום</label>
              <div class="input-group rounded">
                <form class="form-inline">
                        <input class="form-control mr-sm-2" name="value" value="{{ request.value }}" type="search" aria-label="Search">
                        <button class="btn btn-outline-dark btn-sm" type="submit">חיפוש</button>
                    </form>
                </div>
           </div>
        </div>
    </form>
    <div style="margin-top: 25px; text-align: center; margin-bottom: 20px;" >
        <h2 class="fw-bold mb-2">תוצאות חיפוש</h2>
    </div>
    
    <div class="row justify-content-center align-items-start h-100" dir="rtl">
        
        <div class="col-3">
            <form method="GET" action="/search">
            
                <div class="card text-black">
                    <div class="card-body">
                        <h5 class="card-title mb-2 text-center">חיפוש מתקדם</h5>

                        <div class="text-center">

                            <label class="form-label" for="min_age">גיל מינימלי (בחודשים): <output id="min_age_value"></output></label>
                            <div class="form-outline-dark mb-2">
                                <input type="range" class="range" id="min_age" name="min_age" min="{{ min_age.min }}" max="{{ min_age.max }}" value="{{ min_age.value }}" step="1">
                       
                            </div>

                        </div>

                        <div class="text-center">

                            <label class="form-label" for="max_age">גיל מקסימלי (בחודשים): <output id="max_age_value"></output></label>
                            <div class="form-outline-dark mb-2">
                                <input type="range" class="range" id="max_age" name="max_age" min="{{ max_age.min }}" max="{{ max_age.max }}" value="{{ max_age.value }}" step="1">
                            </div>

                        </div>

                        
                        <div class="text-center">

                            <label class="form-label" for="capacity"> כמות ילדים מירבית בגן: <output id="capacity_value"></output></label>
                            <div class="form-outline-dark mb-2">
                                <input type="range" class="range" id="capacity" name="capacity" min="{{ capacity.min }}" max="{{ capacity.max }}" value="{{ capacity.value }}" step="1">   
                            </div>

                        </div>

                        
                        <div class="text-center">

                            <label class="form-label">  שעות פעילות: </label>
                            <div class="form-outline-dark mb-2">
                                החל מהשעה <input type="time" id="open_time" name="open_time" min="{{ open_time.min }}" max="{{ open_time.max }}" value="{{ open_time.value }}">
                            </div>
                            <div class="form-outline-dark mb-2"> 
                                ועד השעה <input type="time" id="close_time" name="close_time" min="{{ close_time.min }}" max="{{ close_time.max }}" value="{{ close_time.value }}"> 
                            </div>
                             
                        </div>
                        <div class="text-center">
                            <button class="btn btn-outline-dark btn-sm" type="submit">פילטר</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <div class="col-8">
            <section  dir="rtl">
                <div class="container">
                      <div class="card text-dark">
                        {% for result in results %}
                            <div class="card-body">
                
                                <div class="flex-start" style="text-align: center;">
                                    <p class="mb-0">
                                        <a href="/kindergarten/{{ result.kindergarten_id }}" data-hover="לדף המפורט של הגן לחצו כאן" style="color: black; text-decoration: none;">
                                            <h4 class="fw-bold mb-0">{{ result.name }}</h4>
                                        </a>
                                    </p>
                                    
                                    <p class="mb-0">
                                        <h5>כתובת: {{ result.address }}, {{ result.region }}</h5>
                                    </p>
                                    <p class="mb-0">
                                        <h5>גילאים: {{ result.get_min_age_display }} עד {{ result.get_max_age_display }}</h5>
                                    </p>
                                </div>
                                <hr class="my-0" />
                            </div>
                        {% endfor %}
                      </div>
                </div>
              </section>

            {% for result in results %}
            <div class="card text-black">
                <div class="card-body p-md-5" style="text-align: center;">
                    <a href="/kindergarten/{{ result.kindergarten_id }}" title="לדף המפורט של הגן לחצו כאן" style="color: black; text-decoration: none;">
                        <h4 class="card-title">{{ result.name }}</h4>
                    </a>
                    <h5>כתובת: {{ result.address }}, {{ result.region }}</h5>
                    <h5>גילאים: {{ result.get_min_age_display }} עד {{ result.get_max_age_display }}</h5>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
   
</body>

{% endblock content%}